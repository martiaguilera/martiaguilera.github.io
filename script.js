// ===== LANGUAGE SYSTEM =====
const translations = {
  ca: {
    'nav-work': 'Treballs',
    'nav-services': 'Serveis',
    'nav-experience': 'Experiencia',
    'nav-about': 'Sobre Mi',
    'nav-contact': 'Contacte',
    'hero-subtitle': 'Creant Experiencies Digitals amb Software, Disseny i Innovacio.',
    'hero-meta': 'Desenvolupador - Basat a Catalunya - (c)2025',
    'hero-btn': 'Veure Projectes',
    'projects-sticky': 'Projectes',
    'projects-title': 'Projectes',
    'services-sticky': 'Serveis',
    'services-title': 'Serveis',
    'services-intro': 'Fundador i CEO de <strong>NuviaDev</strong>, empresa especialitzada en creacio de webs modernes per a negocis locals i emprenedories digitals.',
    'service-1-title': 'Desenvolupament Web a Mida',
    'service-1-desc': 'Llocs web professionals i funcionals adaptats a les teves necessitats especifiques.',
    'service-2-title': 'Disseny UI/UX',
    'service-2-desc': 'Interficies intuïtives i atractives que milloren l\'experiencia de l\'usuari.',
    'service-3-title': 'Desenvolupament d\'Aplicacions',
    'service-3-desc': 'Apps desktop i utilitaris en Python, C, Java i mes tecnologies.',
    'service-4-title': 'Consultoria Tecnica per a PYMES',
    'service-4-desc': 'Assessorament en solucions tecnologiques i infraestructura digital.',
    'service-5-title': 'Integracio i Optimitzacio',
    'service-5-desc': 'Integracio de sistemes i optimitzacio de processos digitals existents.',
    'experience-sticky': 'Experiencia',
    'experience-title': 'Experiencia',
    'education-sticky': 'Formacio',
    'education-title': 'Formacio',
    'about-sticky': 'Sobre Mi',
    'about-title': 'Sobre Mi',
    'contact-sticky': 'Contacte',
    'contact-title': 'Contacte',
    'contact-text': 'Obert a col.laboracions, projectes digitals i idees innovadores.',
    'footer': 'Dissenyat i Desenvolupat per Marti Aguilera (c)2025',
    'project-1-name': 'Els Prats d\'Or',
    'project-1-badge': 'Stack Complet',
    'project-1-desc': 'Botiga online completa per a una granja local. Sistema full-stack amb carret de compres, gestio de productes en temps real i consultes dinamiques a base de dades.',
    'project-2-name': 'Simple Web Server (SWS)',
    'project-2-badge': 'Aplicacio Desktop',
    'project-2-desc': 'Aplicacio Python que converteix qualsevol carpeta en servidor web local. Interficie grafica intuïtiva, portable i sense dependencies externes. Consola integrada per a monitoratge.',
    'project-3-name': 'Autoclicker v1.0',
    'project-3-badge': 'Utilitat',
    'project-3-desc': 'Eina d\'automatitzacio en Python amb tecla d\'activacio personalitzada, intervals configurables en mil.lisegons i interficie simple i eficient.',
    'project-4-name': 'Portfolio Web Personal',
    'project-4-badge': 'Aquest Lloc',
    'project-4-desc': 'Portfolio web personal mostrant projectes, experiencia i formacio academica. Disseny minimalista modern amb animacions suaus i scroll interactiu.',
    'exp-1-date': '2025 - Actualment',
    'exp-1-role': 'CEO & Cofundador',
    'exp-1-company': 'NuviaDev',
    'exp-1-desc': 'Creacio de webs personalitzades, disseny i desenvolupament de projectes digitals. Gestio completa de projectes i relacio amb clients a l\'ecosistema local.',
    'exp-2-date': '2023 - Actualment',
    'exp-2-role': 'Ajudant',
    'exp-2-company': 'Camins de Vent (Vols en Globus)',
    'exp-2-desc': 'Muntatge i preparacio de globus, seguretat en operacions de vol, assistencia a passatgers i coordinacio logistica d\'eventos aeronautics.',
    'exp-3-date': '2024 - 2025',
    'exp-3-role': 'Tecnic de Hardware/Software',
    'exp-3-company': 'MRP Computer',
    'exp-3-desc': 'Reparacio i manteniment d\'equips, instal.lacio i configuracio de sistemes operatius, suport tecnic i desplegament de software.',
    'edu-1-degree': 'Grau Superior DAM',
    'edu-1-school': 'Institut Mila i Fontanals',
    'edu-1-period': '2025 - 2027',
    'edu-2-degree': 'Grau Mitja SMX',
    'edu-2-school': 'Institut Mila i Fontanals',
    'edu-2-period': '2023 - 2025',
    'about-text-1': 'Soc un desenvolupador jove i apaixonat per la tecnologia, actualment cursant DAM (Desenvolupament d\'Aplicacions Multiplataforma) amb interes en aprofundir cap a Enginyeria Informatica. M\'encanta crear solucions reals, utils i modernes, combinant excel.lencia tecnica amb sensibilitat en el disseny.',
    'about-text-2': 'M\'especialitzo en desenvolupament web full-stack, aplicacions d\'escriptori i consultoria tecnica. Soc fundador de NuviaDev, una empresa dedicada a transformar idees en experiencies digitals de qualitat per a negocis locals i emprenedories.',
    'contact-email': 'Correu',
    'contact-github': 'GitHub',
    'contact-linkedin': 'LinkedIn'
  },
  es: {
    'nav-work': 'Trabajos',
    'nav-services': 'Servicios',
    'nav-experience': 'Experiencia',
    'nav-about': 'Sobre Mi',
    'nav-contact': 'Contacto',
    'hero-subtitle': 'Creando Experiencias Digitales con Software, Diseño e Innovación.',
    'hero-meta': 'Desarrollador - Basado en Catalunya - (c)2025',
    'hero-btn': 'Ver Proyectos',
    'projects-sticky': 'Proyectos',
    'projects-title': 'Proyectos',
    'services-sticky': 'Servicios',
    'services-title': 'Servicios',
    'services-intro': 'Fundador y CEO de <strong>NuviaDev</strong>, empresa especializada en creacion de webs modernas para negocios locales y emprendimientos digitales.',
    'service-1-title': 'Desarrollo Web a Medida',
    'service-1-desc': 'Sitios web profesionales y funcionales adaptados a tus necesidades especificas.',
    'service-2-title': 'Diseño UI/UX',
    'service-2-desc': 'Interfaces intuitivas y atractivas que mejoran la experiencia del usuario.',
    'service-3-title': 'Desarrollo de Aplicaciones',
    'service-3-desc': 'Apps desktop y utilitarios en Python, C, Java y mas tecnologias.',
    'service-4-title': 'Consultoria Tecnica para PYMES',
    'service-4-desc': 'Asesoramiento en soluciones tecnologicas e infraestructura digital.',
    'service-5-title': 'Integracion y Optimizacion',
    'service-5-desc': 'Integracion de sistemas y optimizacion de procesos digitales existentes.',
    'experience-sticky': 'Experiencia',
    'experience-title': 'Experiencia',
    'education-sticky': 'Formacion',
    'education-title': 'Formacion',
    'about-sticky': 'Sobre Mi',
    'about-title': 'Sobre Mi',
    'contact-sticky': 'Contacto',
    'contact-title': 'Contacto',
    'contact-text': 'Abierto a colaboraciones, proyectos digitales e ideas innovadoras.',
    'footer': 'Diseñado y Desarrollado por Marti Aguilera (c)2025',
    'project-1-name': 'Els Prats d\'Or',
    'project-1-badge': 'Stack Completo',
    'project-1-desc': 'Tienda online completa para una granja local. Sistema full-stack con carrito de compras, gestion de productos en tiempo real y consultas dinamicas a base de datos.',
    'project-2-name': 'Simple Web Server (SWS)',
    'project-2-badge': 'Aplicacion Desktop',
    'project-2-desc': 'Aplicacion Python que convierte cualquier carpeta en servidor web local. Interfaz grafica intuitiva, portable y sin dependencias externas. Consola integrada para monitoreo.',
    'project-3-name': 'Autoclicker v1.0',
    'project-3-badge': 'Utilidad',
    'project-3-desc': 'Herramienta de automatizacion en Python con tecla de activacion personalizada, intervalos configurables en milisegundos e interfaz simple y eficiente.',
    'project-4-name': 'Portfolio Web Personal',
    'project-4-badge': 'Este Sitio',
    'project-4-desc': 'Portfolio web personal mostrando proyectos, experiencia y formacion academica. Diseño minimalista moderno con animaciones suaves y scroll interactivo.',
    'exp-1-date': '2025 - Actualidad',
    'exp-1-role': 'CEO & Cofundador',
    'exp-1-company': 'NuviaDev',
    'exp-1-desc': 'Creacion de webs personalizadas, diseño y desarrollo de proyectos digitales. Gestion completa de proyectos y relacion con clientes en el ecosistema local.',
    'exp-2-date': '2023 - Actualidad',
    'exp-2-role': 'Ayudante',
    'exp-2-company': 'Camins de Vent (Vuelos en Globo)',
    'exp-2-desc': 'Montaje y preparacion de globos, seguridad en operaciones de vuelo, asistencia a pasajeros y coordinacion logistica de eventos aeronauticos.',
    'exp-3-date': '2024 - 2025',
    'exp-3-role': 'Tecnico de Hardware/Software',
    'exp-3-company': 'MRP Computer',
    'exp-3-desc': 'Reparacion y mantenimiento de equipos, instalacion y configuracion de sistemas operativos, soporte tecnico y despliegue de software.',
    'edu-1-degree': 'Grado Superior DAM',
    'edu-1-school': 'Institut Mila i Fontanals',
    'edu-1-period': '2025 - 2027',
    'edu-2-degree': 'Grado Medio SMX',
    'edu-2-school': 'Institut Mila i Fontanals',
    'edu-2-period': '2023 - 2025',
    'about-text-1': 'Soy un desarrollador joven y apasionado por la tecnologia, actualmente cursando DAM (Desarrollo de Aplicaciones Multiplataforma) con interes en profundizar hacia Ingenieria Informatica. Me encanta crear soluciones reales, utiles y modernas, combinando excelencia tecnica con sensibilidad en el diseño.',
    'about-text-2': 'Me especializo en desarrollo web full-stack, aplicaciones de escritorio y consultoria tecnica. Soy fundador de NuviaDev, una empresa dedicada a transformar ideas en experiencias digitales de calidad para negocios locales y emprendimientos.',
    'contact-email': 'Correo',
    'contact-github': 'GitHub',
    'contact-linkedin': 'LinkedIn'
  },
  en: {
    'nav-work': 'Work',
    'nav-services': 'Services',
    'nav-experience': 'Experience',
    'nav-about': 'About Me',
    'nav-contact': 'Contact',
    'hero-subtitle': 'Creating Digital Experiences with Software, Design and Innovation.',
    'hero-meta': 'Developer - Based in Catalunya - (c)2025',
    'hero-btn': 'View Projects',
    'projects-sticky': 'Projects',
    'projects-title': 'Projects',
    'services-sticky': 'Services',
    'services-title': 'Services',
    'services-intro': 'Founder and CEO of <strong>NuviaDev</strong>, a company specialized in creating modern websites for local businesses and digital startups.',
    'service-1-title': 'Custom Web Development',
    'service-1-desc': 'Professional and functional websites tailored to your specific needs.',
    'service-2-title': 'UI/UX Design',
    'service-2-desc': 'Intuitive and attractive interfaces that enhance user experience.',
    'service-3-title': 'Application Development',
    'service-3-desc': 'Desktop apps and utilities in Python, C, Java and more technologies.',
    'service-4-title': 'Technical Consulting for SMEs',
    'service-4-desc': 'Advice on technological solutions and digital infrastructure.',
    'service-5-title': 'Integration and Optimization',
    'service-5-desc': 'System integration and optimization of existing digital processes.',
    'experience-sticky': 'Experience',
    'experience-title': 'Experience',
    'education-sticky': 'Education',
    'education-title': 'Education',
    'about-sticky': 'About Me',
    'about-title': 'About Me',
    'contact-sticky': 'Contact',
    'contact-title': 'Contact',
    'contact-text': 'Open to collaborations, digital projects and innovative ideas.',
    'footer': 'Designed and Developed by Marti Aguilera (c)2025',
    'project-1-name': 'Els Prats d\'Or',
    'project-1-badge': 'Full Stack',
    'project-1-desc': 'Complete online store for a local farm. Full-stack system with shopping cart, real-time product management and dynamic database queries.',
    'project-2-name': 'Simple Web Server (SWS)',
    'project-2-badge': 'Desktop Application',
    'project-2-desc': 'Python application that converts any folder into a local web server. Intuitive graphical interface, portable and with no external dependencies. Integrated console for monitoring.',
    'project-3-name': 'Autoclicker v1.0',
    'project-3-badge': 'Utility',
    'project-3-desc': 'Python automation tool with customizable activation key, configurable intervals in milliseconds and simple, efficient interface.',
    'project-4-name': 'Personal Web Portfolio',
    'project-4-badge': 'This Site',
    'project-4-desc': 'Personal web portfolio showcasing projects, experience and academic training. Minimalist modern design with smooth animations and interactive scroll.',
    'exp-1-date': '2025 - Present',
    'exp-1-role': 'CEO & Co-founder',
    'exp-1-company': 'NuviaDev',
    'exp-1-desc': 'Creation of personalized websites, design and development of digital projects. Full project management and client relations in the local ecosystem.',
    'exp-2-date': '2023 - Present',
    'exp-2-role': 'Assistant',
    'exp-2-company': 'Camins de Vent (Hot Air Balloons)',
    'exp-2-desc': 'Assembly and preparation of balloons, safety in flight operations, passenger assistance and logistical coordination of aeronautical events.',
    'exp-3-date': '2024 - 2025',
    'exp-3-role': 'Hardware/Software Technician',
    'exp-3-company': 'MRP Computer',
    'exp-3-desc': 'Equipment repair and maintenance, installation and configuration of operating systems, technical support and software deployment.',
    'edu-1-degree': 'Higher Degree DAM',
    'edu-1-school': 'Institut Mila i Fontanals',
    'edu-1-period': '2025 - 2027',
    'edu-2-degree': 'Medium Degree SMX',
    'edu-2-school': 'Institut Mila i Fontanals',
    'edu-2-period': '2023 - 2025',
    'about-text-1': 'I am a young developer passionate about technology, currently pursuing DAM (Multiplatform Application Development) with interest in further studies towards Computer Science. I love creating real, useful and modern solutions, combining technical excellence with design sensitivity.',
    'about-text-2': 'I specialize in full-stack web development, desktop applications and technical consulting. I am founder of NuviaDev, a company dedicated to transforming ideas into quality digital experiences for local businesses and startups.',
    'contact-email': 'Email',
    'contact-github': 'GitHub',
    'contact-linkedin': 'LinkedIn'
  }
};

// Funcion para cambiar idioma
function changeLanguage(lang) {
  // Guardar idioma en localStorage
  localStorage.setItem('preferredLanguage', lang);
  
  // Actualizar todos los elementos con data-lang
  document.querySelectorAll('[data-lang]').forEach(element => {
    const key = element.getAttribute('data-lang');
    if (translations[lang] && translations[lang][key]) {
      const translation = translations[lang][key];
      // Preservar HTML si la traduccion contiene tags
      if (translation.includes('<')) {
        element.innerHTML = translation;
      } else {
        element.textContent = translation;
      }
    }
  });
  
  // Actualizar botones de idioma activos
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-lang') === lang) {
      btn.classList.add('active');
    }
  });
  
  // Actualizar atributo lang del HTML
  document.documentElement.lang = lang;
}

// ===== SMOOTH SCROLL NAVIGATION =====
document.addEventListener('DOMContentLoaded', () => {
  // Cargar idioma guardado o usar catalan por defecto
  const savedLanguage = localStorage.getItem('preferredLanguage') || 'ca';
  changeLanguage(savedLanguage);
  
  // ===== HAMBURGER MENU =====
  const hamburger = document.getElementById('hamburger-menu');
  const mobileMenu = document.getElementById('mobile-menu');
  const navLinks = document.querySelectorAll('.nav-link');
  const mobileNavLinks = document.querySelectorAll('.mobile-menu .nav-link');
  
  // Toggle menu al hacer click en hamburguesa
  if (hamburger) {
    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      mobileMenu.classList.toggle('active');
    });
  }
  
  // Cerrar menu al hacer click en un link de navegacion
  const allNavLinks = [...navLinks, ...mobileNavLinks];
  allNavLinks.forEach(link => {
    link.addEventListener('click', () => {
      hamburger.classList.remove('active');
      mobileMenu.classList.remove('active');
    });
  });
  
  // Event listeners para botones de idioma (desktop y mobile)
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.getAttribute('data-lang');
      changeLanguage(lang);
      // Actualizar ambos grupos de botones
      document.querySelectorAll('.lang-btn').forEach(b => {
        b.classList.remove('active');
        if (b.getAttribute('data-lang') === lang) {
          b.classList.add('active');
        }
      });
    });
  });
  
  // Smooth scroll para los links del navbar
  allNavLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const targetId = link.getAttribute('href');
      const targetSection = document.querySelector(targetId);
      
      if (targetSection) {
        const offsetTop = targetSection.offsetTop - 80;
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });
      }
    });
  });
});

// ===== INTERSECTION OBSERVER PARA ANIMACIONES =====
const observerOptions = {
  threshold: 0.1,
  rootMargin: '0px 0px -100px 0px'
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.style.animation = `fadeInUp 0.6s ease-out forwards`;
      observer.unobserve(entry.target);
    }
  });
}, observerOptions);

// Observar todos los elementos con clase fade-up
document.addEventListener('DOMContentLoaded', () => {
  const fadeElements = document.querySelectorAll('.fade-up');
  fadeElements.forEach((el, index) => {
    el.style.opacity = '0';
    el.style.animationDelay = `${index * 0.1}s`;
    observer.observe(el);
  });

  // Efecto typing en el subtitulo del hero
  startTypingEffect();
  
  // Event listener para cuando cambia el idioma
  const navLinks = document.querySelectorAll('.nav-link');
  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      setTimeout(() => {
        startTypingEffect();
      }, 300);
    });
  });

  // Navbar sticky effects
  window.addEventListener('scroll', () => {
    const navbar = document.querySelector('.navbar');
    if (window.scrollY > 50) {
      navbar.style.backdropFilter = 'blur(10px)';
      navbar.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
    } else {
      navbar.style.backdropFilter = 'blur(0px)';
      navbar.style.backgroundColor = 'transparent';
    }

    // Section title rotation effect
    const sectionTitles = document.querySelectorAll('.section-hero-title');
    sectionTitles.forEach(title => {
      const rect = title.getBoundingClientRect();
      const scrollProgress = (window.innerHeight - rect.top) / window.innerHeight;
      if (scrollProgress > 0 && scrollProgress < 1) {
        const rotation = scrollProgress * 15;
        title.style.transform = `perspective(1000px) rotateX(${rotation}deg)`;
      }
    });

    // Active nav link tracking
    const sections = document.querySelectorAll('section');
    sections.forEach(section => {
      const rect = section.getBoundingClientRect();
      if (rect.top <= 100 && rect.bottom >= 100) {
        const id = section.getAttribute('id');
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === `#${id}`) {
            link.classList.add('active');
          }
        });
      }
    });

    // Card opacity on scroll
    const cards = document.querySelectorAll('.project-card, .service-card, .education-card');
    cards.forEach(card => {
      const rect = card.getBoundingClientRect();
      const scrollProgress = (window.innerHeight - rect.top) / window.innerHeight;
      card.style.opacity = Math.min(1, scrollProgress * 1.5);
    });
  });

  // Mouse tracking effect for cards
  const cards = document.querySelectorAll('.project-card, .service-card, .education-card, .contact-link');
  cards.forEach(card => {
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      card.style.setProperty('--mouse-x', `${x}px`);
      card.style.setProperty('--mouse-y', `${y}px`);
    });

    card.addEventListener('mouseleave', () => {
      card.style.setProperty('--mouse-x', '50%');
      card.style.setProperty('--mouse-y', '50%');
    });
  });

  // Email copy to clipboard
  const emailLink = document.querySelector('[data-lang="contact-email"]');
  if (emailLink && emailLink.parentElement.href.includes('mailto:')) {
    emailLink.parentElement.addEventListener('click', (e) => {
      e.preventDefault();
      const email = 'marti@nuviadev.com';
      navigator.clipboard.writeText(email).then(() => {
        const originalText = emailLink.textContent;
        emailLink.textContent = 'Copiat!';
        setTimeout(() => {
          emailLink.textContent = originalText;
        }, 2000);
      });
    });
  }
});

// ===== TYPING EFFECT =====
function startTypingEffect() {
  const typingText = document.querySelector('.typing-text');
  if (!typingText) return;

  const key = typingText.getAttribute('data-lang');
  if (!key) return;

  const currentLang = localStorage.getItem('preferredLanguage') || 'ca';
  const text = translations[currentLang][key] || '';

  if (!text) return;

  typingText.textContent = '';
  typingText.classList.remove('complete');
  let index = 0;
  const speed = 50; // ms per character

  function type() {
    if (index < text.length) {
      typingText.textContent += text.charAt(index);
      index++;
      setTimeout(type, speed);
    } else {
      typingText.classList.add('complete');
    }
  }

  // Delay before starting
  setTimeout(type, 800);
}

// Parallax effect on scroll
document.addEventListener('scroll', () => {
  const parallaxElements = document.querySelectorAll('[data-parallax]');
  parallaxElements.forEach(element => {
    const scrollPosition = window.scrollY;
    const offset = scrollPosition * 0.5;
    element.style.transform = `translateY(${offset}px)`;
  });
});
